name: View Logs

on:
  workflow_dispatch:
    inputs:
      lines:
        description: 'Number of log lines to fetch'
        required: false
        default: '100'
        type: string

jobs:
  fetch-logs:
    runs-on: ubuntu-latest
    steps:
      - name: Add key to ssh agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.HETZNER_SSH_PRIVATE_KEY }}

      - name: Add server as known host
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H ${{ vars.HETZNER_BARE_METAL_DEPLOY_TARGET_SERVER_IPS }} >> ~/.ssh/known_hosts

      - name: Fetch logs from server
        run: |
          echo "=== Last ${{ inputs.lines }} lines of storj-interface logs ==="
          ssh root@${{ vars.HETZNER_BARE_METAL_DEPLOY_TARGET_SERVER_IPS }} "journalctl -u storj-interface -n ${{ inputs.lines }} --no-pager"
